package commandline_test

import (
	"testing"

	"github.com/magicdrive/kirke/internal/commandline"
)

// Helper function to compare only relevant fields in Option
func compareOptions(t *testing.T, expected, result *commandline.Option) {
	t.Helper()
	if expected.RootObjName != result.RootObjName {
		t.Errorf("Expected RootObjName %q, got %q", expected.RootObjName, result.RootObjName)
	}
	if expected.Json != result.Json {
		t.Errorf("Expected Json %q, got %q", expected.Json, result.Json)
	}
	if expected.FilePath != result.FilePath {
		t.Errorf("Expected FilePath %q, got %q", expected.FilePath, result.FilePath)
	}
	if expected.NullAs != result.NullAs {
		t.Errorf("Expected NullAs %q, got %q", expected.NullAs, result.NullAs)
	}
	if expected.WithPointerFlag != result.WithPointerFlag {
		t.Errorf("Expected WithPointerFlag %v, got %v", expected.WithPointerFlag, result.WithPointerFlag)
	}
	if expected.HelpFlag != result.HelpFlag {
		t.Errorf("Expected HelpFlag %v, got %v", expected.HelpFlag, result.HelpFlag)
	}
	if expected.VersionFlag != result.VersionFlag {
		t.Errorf("Expected VersionFlag %v, got %v", expected.VersionFlag, result.VersionFlag)
	}
	if expected.ForcePipeFlag != result.ForcePipeFlag {
		t.Errorf("Expected PipeFlag %v, got %v", expected.ForcePipeFlag, result.ForcePipeFlag)
	}
	if expected.NoPagerFlag != result.NoPagerFlag {
		t.Errorf("Expected NoPagerFlag %v, got %v", expected.NoPagerFlag, result.NoPagerFlag)
	}
}

func TestOptParse_NoArgs(t *testing.T) {
	args := []string{}
	expected := &commandline.Option{
		RootObjName:     "AutoGenerated",
		Json:            "",
		FilePath:        "",
		NullAs:          "interface{}",
		WithPointerFlag: false,
		HelpFlag:        false,
		VersionFlag:     false,
		ForcePipeFlag:   false,
		NoPagerFlag:     false,
		InlineFlag:      false,
		OutlineFlag:     false,
	}

	_, result, err := commandline.OptParse(args)
	if err != nil {
		t.Fatalf("Expected no error, got %v", err)
	}

	// Compare only the relevant fields
	compareOptions(t, expected, result)
}

func TestOptParse_WithFlags(t *testing.T) {
	args := []string{
		"-n", "TestStruct",
		"-j", `{"key": "value"}`,
		"-f", "input.json",
		"-a", "any",
		"--with-pointer",
		"--help",
		"--version",
		"--pipe",
		"--no-pager",
	}
	expected := &commandline.Option{
		RootObjName:     "TestStruct",
		Json:            `{"key": "value"}`,
		FilePath:        "input.json",
		NullAs:          "any",
		WithPointerFlag: true,
		HelpFlag:        true,
		VersionFlag:     true,
		ForcePipeFlag:   true,
		NoPagerFlag:     true,
		InlineFlag:      true,
		OutlineFlag:     true,
	}

	_, result, err := commandline.OptParse(args)
	if err != nil {
		t.Fatalf("Expected no error, got %v", err)
	}

	// Compare only the relevant fields
	compareOptions(t, expected, result)
}
